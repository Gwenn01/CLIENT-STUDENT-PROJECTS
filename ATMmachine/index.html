<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATM Machine</title>
    <style>
      /* Resetting default margins and paddings */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #1D2228;
        }

        /* Container styles */
        .container {
            max-width: 600px;
            margin: 50px auto;
            background-color: #E1E2E2;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        /* Heading styles */
        h1, h3 {
            text-align: center;
        }

        /* Form styles */
        select, input[type="number"], button {
            display: block;
            width: 100%;
            margin-bottom: 20px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        button {
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* Initially hide Enter Amount section */
        #enterAmount {
            display: none;
        }

        /* History styles */
        #history {
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }

        #history p {
            margin-bottom: 10px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>ATM Machine</h1>
        <h3 id="balance">BALANCE: 0</h3>
        <div>
            <p>Option</p>
            <select id="options">
                <option value=""></option>
                <option value="checkbal">Check Balance</option>
                <option value="withdraw">Withdraw</option>
                <option value="deposit">Deposit</option>
            </select>
        </div>
        <div id="enterAmount">
            <!--generated by js
             '<p>Amount</p> <input type="number" id="amount" name="amount" placeholder="Enter Amount" required> <button id="enterAmountSubmit">Submit</button>'
            -->
        </div>
        <h3>History</h3>
        <div id="history">
            
        </div>
    </div>
</body>
<script>
    // define the balance account and the history to save the changes
    let balanceAmount = 0;
    let history = "";
    // define the message if its successfully process
    class Message{
            push_message_balance(){
                let message = "<p>Your request Check Balance has been successfully processed! </p><br>";
                history += message;
                document.getElementById("history").innerHTML = history;
            }
            push_message_withdraw(){
                let message = "<p>Your withdrawal request has been successfully processed! </p><br>";
                history += message;
                document.getElementById("history").innerHTML = history;
            }
            push_message_deposit(){
                let message = "<p>Your deposit request has been successfully processed! </p><br>";
                history += message;
                document.getElementById("history").innerHTML = history;
            }
    }
    class CheckBalance{
        constructor(option){
            this.option = option;
            //composition to use the method on this class
            this.message = new Message();
        }
        //polymorphism 
        process(){
            if(this.option == "checkbal"){
                // check the balance 
                const balance = document.getElementById("balance");
                balance.innerHTML = `BALANCE: ${balanceAmount}`;
                // if the user already deposit or withdraw and we check the balance, we need to clear the enterAmount
                let enterAmountEl = document.getElementById("enterAmount");
                enterAmountEl.innerHTML = "";
            }
        }
    }
    class Withdraw extends CheckBalance{
        constructor(option){
            super(option);
            //composition
            this.message = new Message();
        }
        //polymorphism
        async process() {
            // check the option 
            if (this.option === "withdraw") {
                // create a html so that user can input the amount
                let enterAmountEl = document.getElementById("enterAmount");
                const enterAmountHtml = '<p>Amount</p> <input type="number" id="amount" name="amount" placeholder="Enter Amount" required> <button id="enterAmountSubmit">Submit</button>';
                enterAmountEl.innerHTML = enterAmountHtml;
                // show it in html
                enterAmountEl.style.display = "block";
                // define the asynchronous function wait the user first to input the amount before diplaying the message
                // if the user already input the amount, the message will be displayed
                return new Promise((resolve) => {
                    document.getElementById("enterAmountSubmit").addEventListener("click", (e) => {
                        e.preventDefault();
                        let amountValue = parseInt(document.getElementById('amount').value);
                        // check the amount if its valid
                        if (isNaN(amountValue) || amountValue <= 0) {
                            alert("Please enter a valid amount");
                            return;
                        }
                        // check the balance, if the amount is 0 we can't withdraw 
                        if (balanceAmount <= 0 || balanceAmount < amountValue) {
                            alert("Insufficient Balance");
                            return;
                        }
                        // process the balance
                        balanceAmount -= amountValue;
                        // set some delay to calculate it properly
                        setInterval(() => {
                            document.getElementById("balance").innerHTML = `BALANCE: ${balanceAmount}`;
                        }, 2000);
                        // if the calculation is done call the message in the composition
                        this.message.push_message_withdraw();
                         // remove the value in enter amount
                        document.getElementById('amount').value = 0;
                        resolve('Successfully');
                    });
                });
            }
        }
    }
    class Deposit extends Withdraw{
        constructor(option){
            super(option);
            //composition to use the method on this class
            this.message = new Message();
        }
        //polymorphism
        async process(){
            // check the option
            if(this.option == "deposit"){
                 // create a html so that user can input the amount
                let enterAmountEl = document.getElementById("enterAmount");
                const enterAmountHtml = '<p for="amount">Amount</p> <input type="number" id="amount" name="amount" placeholder="Enter Amount" required> <button id="enterAmountSubmit">Submit</button>';
                enterAmountEl.innerHTML = enterAmountHtml;
                // show it in html
                enterAmountEl.style.display = "block";
                // define the asynchronous function wait the user first to input the amount before diplaying the message
                // if the user already input the amount, the message will be displayed
                return new Promise((resolve) => {
                    document.getElementById("enterAmountSubmit").addEventListener("click", (e) => {
                        e.preventDefault();
                        // check the amount if its valid
                        let amountValue = parseInt(document.getElementById('amount').value);
                        if (isNaN(amountValue) || amountValue <= 0) {
                            alert("Please enter a valid amount");
                            return;
                        }
                        // process the balance
                        balanceAmount += amountValue;
                        // set some delay to calculate it properly
                        setInterval(() => {
                            document.getElementById("balance").innerHTML = `BALANCE: ${balanceAmount}`;
                        }, 2000);
                        // if the calculation is done call the message in the composition
                        this.message.push_message_deposit();
                        // remove the value in enter amount
                        document.getElementById('amount').value = 0;
                        resolve('Successfully');
                    });
                });
            }
        }
    }

    // define the option
    const option = document.getElementById("options");
    option.addEventListener("change", async(e)=>{
        // check the option and then call the objects
        // example: if the option is checkbal, then call the CheckBalance object
        if(option.value == "checkbal"){
            // create an instance of object
            const checkBalance = new CheckBalance(option.value);
            // call the function to display the message
            checkBalance.process();
            checkBalance.message.push_message_balance();
        }else if(option.value == "withdraw"){
            // create an instance of object
            const withdraw = new Withdraw(option.value);
            // wait the user to input the amount before diplaying the message
            await withdraw.process().then((result) => {
                alert(result);
            });
        }else if(option.value == "deposit"){
            // create an instance of object
            const deposit = new Deposit(option.value);
            // wait the user to input the amount before diplaying the message
            await deposit.process().then((result) => {
                alert(result);
            });
        }
    });
</script>
</html>